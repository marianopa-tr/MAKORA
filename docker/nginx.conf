server {
    listen       80;
    server_name  _;

    root   /usr/share/nginx/html;
    index  index.html;

    # ── API endpoints → proxy to the worker container ────────────────
    # These paths match the shared app worker's route handlers.
    # Custom headers (X-Etoro-Api-Key, etc.) are forwarded by default.
    location ~ ^/(status|tick|config|health|logs|signals|history|enable|disable|trigger|kill|shared-data)(/|$) {
        proxy_pass         http://worker:8788;
        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
        proxy_read_timeout 120s;
    }

    # ── Redirect root to /app (the Shared App page) ─────────────────
    location = / {
        return 302 /app;
    }

    # ── SPA fallback ────────────────────────────────────────────────
    # Serve static assets first; fall back to index.html for React Router.
    location / {
        try_files $uri $uri/ /index.html;
    }

    # ── Caching for static assets ───────────────────────────────────
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico|woff2?)$ {
        expires    30d;
        add_header Cache-Control "public, immutable";
    }
}
